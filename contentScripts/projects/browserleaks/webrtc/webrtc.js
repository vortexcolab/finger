!function(){var t=!1,s={local:[],public:[]},r={ipv4:"",ipv6:""},u={},f=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.170/32","192.0.0.171/32","192.0.0.0/24","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","255.255.255.255/32","224.0.0.0/4","240.0.0.0/4"],l=["::1/128","::/128","::ffff:0:0/96","::ffff:0:0:0/96","64:ff9b::/96","64:ff9b:1::/48","100::/64","2001::/23","2001:db8::/32","2002::/16","2620:4f:8000::/48","fc00::/7","fe80::/10","ff00::/8"],i=_el("#client-ipv4"),a=_el("#client-ipv6"),c=_el("#rtc-leak"),p=_el("#rtc-local"),v=_el("#rtc-public"),h=_el("#rtc-sdp"),m=_el("#rtc-enumeratedevices"),o=_el("#rtc-audio-button"),g=_el("#rtc-audio-permission"),d=_el("#rtc-video-button"),b=_el("#rtc-video-permission"),L=_el("#rtc-device-ids"),n=(r.ipv4=i.dataset.ip,u[r.ipv4]=i.dataset.iso_code,H(),k(),!1),T=!1;try{var e=x({iceServers:[{urls:"stun:0"}]});e&&(n=!0),"function"==typeof e.createDataChannel&&(T=!0)}catch(e){T=n=!1}function _(){var e=!1,n=!1;if(0<s.local.length&&(e=!0),0<s.public.length)for(var t=0;t<s.public.length;t++)if(r.ipv4!==s.public[t]&&r.ipv6!==s.public[t]){n=!0;break}var i="",a=e?ico(0,"!")+"WebRTC exposes your Local IP":ico(1)+"No Local IP Leak",o=n?ico(0,"!")+"WebRTC IP doesn't match your Remote IP":ico(1)+"No Public IP Leak";e||n?(i=a,c.previousSibling.setAttribute("rowspan","2"),(e=document.createElement("tr")).classList.add("rtc-leak-tr"),(a=document.createElement("td")).innerHTML=o,e.appendChild(a),(o=c.parentNode).parentNode.insertBefore(e,o.nextSibling)):i=ico(1)+"No Leak",c.classList.remove("load-td"),c.innerHTML=i}function k(){h.parentElement.classList.add("n"),o.disabled=!0,d.disabled=!0,[c,p,v].forEach(function(e){e.textContent=""}),v.innerHTML="",_els(".rtc-leak-tr").forEach(function(e){e.remove()}),c.previousSibling.removeAttribute("rowspan"),c.classList.add("load-td");var e=function(){if(t)return Promise.resolve();a.classList.add("load-td");var e="https://[2604:a880:800:10::e6:b001]/api/iso_code";return i.dataset.tor&&(e="https://ipv6.browserleaks.com/api/iso_code"),fetch(e,{cache:"no-store"}).then(function(e){return e.json()}).then(function(e){var n;r.ipv6=e.ip,n=e.iso_code||"unknown",a.innerHTML=flagBox(n,e.ip,!0),u[e.ip]=n}).catch(function(){a.textContent="-"}).finally(function(){t=!0,a.classList.remove("load-td")})}(),n=new Promise(function(e,n){var t=function(e){for(var n in e){e[n]=function(e){for(var n=[],t=[],i=0;i<e.length;i++)-1!==e[i].indexOf(".")?n.push(e[i]):-1!==e[i].indexOf(":")&&t.push(e[i]);return n.concat(t)}(e[n]);var t="local"==n?p:v;if(e[n].length)for(var i in 1<e[n].length&&t.classList.add("flag-multi"),e[n]){var a,i=e[n][i];"local"==n?t.insertAdjacentHTML("beforeend",flagBox("local",i,!0)):(a="ip-"+i.replace(/[\.\:\%]/g,"-"),t.insertAdjacentHTML("beforeend",flagBox(!1,i,!0,' id="'+a+'"')),function(n,e){var t;u[n]?D(u[n],e):fetch("/api/iso_code/"+n).then(function(e){return e.json()}).then(function(e){t=e.iso_code||"unknown",u[n]=t}).catch(function(e){}).finally(function(){D(t||"unknown",e)})}(i,a))}else t.textContent="-"}},i=e,a=n,o=[],r=x({iceServers:[{urls:[e="stun:stun.l.google.com:19302"],url:e}]},{optional:[{RtpDataChannels:!0}]})||!1;if(r&&"function"==typeof r.createOffer){"function"==typeof r.createDataChannel&&r.createDataChannel("bl"),r.addEventListener("icecandidate",f);try{r.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1}).then(function(e){if(!y(e))throw null;e.sdp=C(e.sdp),r.setLocalDescription(e)}).catch(function(){r.createOffer().then(function(e){if(!y(e))throw null;e.sdp=C(e.sdp),r.setLocalDescription(e)}).catch(function(){return a()})})}catch(e){r.createOffer(function(e){if(!y(e))return a();r.setLocalDescription(e,function(){},function(){})},function(e){return a()})}var c=0,d=setInterval(function(){var e,n=!1,t=r.localDescription;(e=y(t)?t.sdp.split("\n"):e)&&e.forEach(function(e){-1!==e.indexOf("candidate:")&&(e=E(e))&&(M(e)||(n=!0),o.indexOf(e)<0)&&o.push(e)}),c++,(n||5<=c)&&l()},3e3)}else a();function f(e){var n;e.candidate&&e.candidate.candidate&&(n=E(e.candidate.candidate))&&o.indexOf(n)<0&&o.push(n),null==e.candidate&&l()}function l(){r.removeEventListener("icecandidate",f),clearInterval(d),h.parentElement.classList.remove("n"),r.localDescription&&(h.textContent=r.localDescription.sdp),o.forEach(function(e){var n=M(e)?"local":"public";-1===s[n].indexOf(e)&&s[n].push(e)}),r.close(),t(s),i()}}).catch(function(){[p,v,h.parentElement.parentElement].forEach(function(e){e&&(e.textContent="-")}),_()});Promise.all([e,n]).then(function(){_()}).finally(function(){o.disabled=!1,d.disabled=!1})}function x(e,n){for(var t,i,a=["","webkit","moz","ms"],o="RTCPeerConnection",r=0;r<a.length;r++)if(t=(t=window[a[r]+o])||(i=i||_el("#rtc-iframe")).contentWindow[a[r]+o])return new t(e,n||{});return!1}function y(e){return e&&e.sdp&&!(e.sdp.length<10)}function C(e){var n="v=0\r\n";return e.substring(0,n.length)!==n?n+e:e}function D(e,n){var t,n=_el("#"+n);2==e.length?(t=countryNames(e),n.title=t?t+" ("+e+")":e,n.alt=e):n.title=e.charAt(0).toUpperCase()+e.slice(1),n.src="/img/flags/"+e+".png"}function E(e){return!(null===(e=/([0-9]{1,3}(\.[0-9]{1,3}){3}|(([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))/.exec(e))||!e[1])&&e[1]}function M(e){function a(e,n){return e.length<n?a("0"+e,n):e}function n(e){var n,t,i="";if(-1<e.indexOf(":"))for(n=e.split(":"),t=0;t<n.length;t++)i+=a(parseInt(n[t],16).toString(2),16);else for(n=e.split("."),t=0;t<n.length;t++)i+=a(parseInt(n[t],10).toString(2),8);return i}for(var t=n(e),i=-1<e.indexOf(":")?l:f,o=0,r=i.length;o<r;o++){var c=i[o].split("/"),d=n(c[0]);if(t.substring(0,c[1])===d.substring(0,c[1]))return 1}}function H(d){d=d||!1;var f=!1,l=!1,e=[];navigator.permissions&&"function"==typeof navigator.permissions.query&&(e.push(navigator.permissions.query({name:"microphone"}).then(function(e){f=e.state}).catch(function(){f=!1})),e.push(navigator.permissions.query({name:"camera"}).then(function(e){l=e.state}).catch(function(){l=!1}))),Promise.all(e).then(function(){navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(e){function n(e,n){var t;switch(e){case"granted":t=ico(0,"!")+"Granted Permanently";break;case"prompt":t=ico(2)+"Prompt";break;case"deined":t=ico(0)+"Denied";break;default:t=n?i?ico(1)+"Granted":ico(0,"!")+"Granted Permanently":ico(2)+"Prompt"}return t}var t,i=d,a=f,o=l,r=!(t=""),c={};e.forEach(function(e){r||(t+="\n"),r=!1,t+=function(e){for(var n=["kind","label","deviceId","groupId"],t="",i=0;i<n.length;i++){var a=n[i],o=8-a.length,o=Array(1+o).join(" ")+a,r=e[a]||"n/a";t+=o+": "+("kind"===a?"<b>"+r+"</b>":r)+"\n"}return t}(e),c[e.kind]||(c[e.kind]=!!e.label.length)}),g.innerHTML=n(a,c.audioinput),b.innerHTML=n(o,c.videoinput),m.innerHTML=ico(1)+"True",""!=t?(L.classList.add("mono"),L.innerHTML=t):L.textContent="n/a"}).catch(function(e){P()}):P()})}function w(t,e){navigator.mediaDevices.getUserMedia({audio:t,video:e}).then(function(){H(!0),k()}).catch(function(e){var n;return(t?g:b).innerHTML=ico(0)+(n='"'+e.name+'"',e.message&&(n+=" â€“ "+e.message),n),!1})}function P(){m.innerHTML=ico(0)+"False",[g,b,L].forEach(function(e){e.textContent="n/a"})}_el("#rtc-peerconnection").innerHTML=n?ico(1)+"True":ico(0)+"False",_el("#rtc-datachannel").innerHTML=T?ico(1)+"True":ico(0)+"False",o.addEventListener("click",function(){w(!0,!1),g.innerHTML=ico(2)}),d.addEventListener("click",function(){w(!1,!0),b.innerHTML=ico(2)})}();
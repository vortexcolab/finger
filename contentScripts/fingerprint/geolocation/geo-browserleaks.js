!function(){var e,t,p=!1,g=!0,o=!0,f=!1,v=_el("#geo-watch-load"),h=_el("#geo-watch-button"),w=_el("#geo-update-row"),b=_el("#geo-update-button"),a=_el("#geo-watch-status"),s=_el("#geo-watch-hint"),y=_el("#geo-warn"),_=_els(".geo-data"),n=_el("#geo-glob"),k=_el("#geo-content"),C=_el(".map-warn"),M=_el("#map-canvas"),E=!!k.dataset.imperial;function r(){g=!0,b.disabled=!0,b.title='Deactivate "Watch Position" first',b.classList.add("cursor-help"),a.textContent="",a.classList.remove("geo-active"),e=navigator.geolocation.watchPosition(i,l,{enableHighAccuracy:!0,timeout:3e4,maximumAge:0})}function i(e){h.checked=!0,h.disabled=!1,a.textContent="Active",a.classList.add("geo-active"),s.classList.remove("n"),p=!0,e&&m(e)}function l(e){1===e.code?c():i(!1),d(e)}function c(){b.disabled=!1,b.title="",b.classList.remove("cursor-help"),h.checked=!1,a.textContent="not active",a.classList.remove("geo-active"),s.classList.add("n"),o=!(p=!1),navigator.geolocation.clearWatch(e)}function d(e){b.classList.remove("n"),w.className="more",v.classList.add("n"),h.disabled=!1,p||(b.disabled=!1);var t=["UNKNOWN_ERROR"+(e.message?" – "+e.message:""),"PERMISSION_DENIED – User denied Geolocation.","POSITION_UNAVAILABLE – The current position could not be determined","TIMEOUT"+(e.message?" – "+e.message:"")];y.innerHTML='<div class="warn">'+x(new Date,!0)+" ["+e.code+"] "+t[e.code]+"</div>",y.classList.remove("n"),k.classList.add("n"),M.classList.add("n")}function m(r){function i(e){e.target.classList.remove("geo-data-refresh"),e.target.removeEventListener("animationend",i)}b.classList.remove("n"),w.className="more",v.classList.add("n"),h.disabled=!1,p||(b.disabled=!1);var e,t,a,o,s,n,l,c,d=!1,m=_el("#geo-swap");function u(e){return e*Math.PI/180}Cookies.get("bl_geo_raw")&&(d=!0,m.textContent="parsed values"),f||(f=!0,m.addEventListener("click",function(){d?(m.textContent="raw values",d=!1,Cookies.remove("bl_geo_raw")):(m.textContent="parsed values",d=!0,Cookies.set("bl_geo_raw",1)),_.forEach(function(e){e.innerHTML=d?e.dataset.raw:e.dataset.parsed})})),_.forEach(function(e){var t,a,o,s=e.id,n="timestamp"==s?r.timestamp:r.coords[s];if(n)switch(s){case"latitude":case"longitude":t=n+"&deg;";break;case"heading":t=parseFloat(parseFloat(n).toFixed(2))+"&deg;";break;case"accuracy":case"altitudeAccuracy":a=.1<(a=(o=n)/1e3*.621371)?parseFloat(parseFloat(a).toFixed(2))+" mile"+(a<2?"":"s"):Math.round(5280*a)+" feet",o=1e3<=o?(o=parseFloat(parseFloat(o/1e3).toFixed(2)),parseFloat(parseFloat(o).toFixed(2))+" kilometer"+(o<2?"":"s")):parseFloat(parseFloat(o).toFixed(2))+" meter"+(o<2?"":"s"),t="about "+(E?a+" (or "+o+")":o+" (or "+a+")");break;case"speed":t=parseFloat(parseFloat(n).toFixed(2))+" m/s";break;case"altitude":t=parseFloat(parseFloat(n).toFixed(2))+" meters";break;case"timestamp":t=x(new Date(n))}else t=n=void 0!==n?"<i>"+String(n)+"</i>":"<i>undefined</i>";s=(n="string"!=typeof n?String(n):n)!==e.dataset.raw,e.dataset.raw=n,e.dataset.parsed=t,e.innerHTML=d?n:t,s&&(e.classList.add("geo-data-refresh"),e.addEventListener("animationend",i))}),y.classList.add("n"),r.coords.longitude&&r.coords.latitude&&(k.classList.remove("n"),M.classList.remove("n"),e=!1,window.latlon&&(o=r.coords.latitude,c=r.coords.longitude,s=window.latlon[0],l=window.latlon[1],n=u(s-o),l=u(l-c),o=u(o),s=u(s),c=Math.sin(n/2)*Math.sin(n/2)+Math.sin(l/2)*Math.sin(l/2)*Math.cos(o)*Math.cos(s),e=10<2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))*6371*1e3),window.latlon&&!e||((t=_el("#geo-reverse")).innerHTML='<div class="load-div"></div>',fetch("https://nominatim.openstreetmap.org/reverse?format=json&accept-language=en&zoom=18&lat="+r.coords.latitude+"&lon="+r.coords.longitude).then(function(e){return e.json()}).then(function(e){"object"==typeof e&&!e.error&&e.address&&e.address.country_code&&e.display_name?a=flagBox(e.address.country_code.toUpperCase(),e.display_name):(a="API Error","object"==typeof data&&e.error&&(a+=": "+e.error))}).catch(function(e){a="Request Error: "+e.message}).finally(function(){t.innerHTML=a})),window.latlon=[r.coords.latitude,r.coords.longitude],Cookies.get("bl_map")&&!window.map?(C.classList.remove("n"),M.classList.add("n"),_el("#map-button").addEventListener("click",function(){F(r.coords.latitude,r.coords.longitude,r.coords.accuracy)})):F(r.coords.latitude,r.coords.longitude,r.coords.accuracy)),p&&(g=!1)}function F(e,t,a){C.classList.add("n"),M.classList.remove("n"),e=new L.LatLng(e,t),L.Icon.Default.imagePath="/img/leaflet/",t=L.tileLayer("https://cartodb-basemaps-{s}.freetls.fastly.net/rastertiles/voyager/{z}/{x}/{y}{r}.png",{subdomains:"a",attribution:Cookies.get("bl_attr")?"":'&copy; <a href="https://www.openstreetmap.org/copyright" rel="nofollow noopener" target="_blank">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attribution/" rel="nofollow noopener" target="_blank">CARTO</a>'}),window.map?(map.removeLayer(t),map.removeLayer(mapLayerCircle),p&&!g||map.removeLayer(mapLayerMarker)):((map=L.map(M,{scrollWheelZoom:!1})).setView(e),map.attributionControl.setPrefix(""),map.addControl(new L.Control.Fullscreen),map.on("fullscreenchange contextmenu zoomanim click dblclick rightclick drag",function(){map.scrollWheelZoom.enabled()||map.scrollWheelZoom.enable()}),map.on("mouseout",function(){map.scrollWheelZoom.enabled()&&map.scrollWheelZoom.disable()}),map.on("fullscreenchange",function(){map.isFullscreen()||map.fitBounds(mapLayerCircle.getBounds())})),window.mapLayerCircle=L.circle(e,{interactive:!1,opacity:.8,color:"#398dcd",weight:2,radius:a,fillOpacity:.1}).addTo(map),map.fitBounds(mapLayerCircle.getBounds()),p||(o=!0),p&&!g&&window.mapLayerMarker?window.mapLayerMarker.setLatLng(e):window.mapLayerMarker=L.marker(e,{opacity:.8,interactive:!1,bounceOnAdd:o,bounceOnAddOptions:{duration:500}}).addTo(map),p&&(o=o&&!1),t.addTo(map)}function x(e,t){var a=u(e.getHours(),2)+":"+u(e.getMinutes(),2)+":"+u(e.getSeconds(),2)+"."+u(e.getMilliseconds(),3);return void 0===t&&(a+=" "+(t=e.getTimezoneOffset(),e=!1,(t/=60)<=0&&(e=!0,t*=-1),t%1!=0?t=100*Math.floor(t)+t%1*60:t*=100,e?"+":"-")+u(t,4)),a}function u(t,a,o){void 0===o&&(o="0");try{return t.toString().padStart(a,o)}catch(e){for(t=t.toString();t.length<a;)t=o+t;return t}}void 0!==navigator.permissions?(navigator.permissions.query({name:"geolocation"}).then(function(e){function t(t){_els("#geo-orig div").forEach(function(e){-1!==e.id.indexOf(t.state)?e.classList.remove("n"):e.classList.add("n")})}t(e),e.onchange=function(){t(e)}}).catch(function(e){}),n.classList.add("load-td"),(t=document.createElement("iframe")).src="https://permissions.browserleaks.org/geolocation.html?v=59060426",t.className="n",t.onload=window.addEventListener("message",function(t){var a=!1;"https://permissions.browserleaks.org"==t.origin&&_els("div",n).forEach(function(e){-1!==e.id.indexOf(t.data)?(a=!0,e.classList.remove("n")):e.classList.add("n")}),a&&n.classList.remove("load-td")}),document.body.appendChild(t)):[_el("#geo-orig"),n].forEach(function(e){e.innerHTML=ico(0)+"Your browser doesn't support Permissions API"}),"object"!=typeof navigator.geolocation?(_el("#geo-false").classList.remove("noscript"),h.parentElement.classList.remove("pointer"),h.parentElement.style.cursor="not-allowed",h.disabled=!0,h.style.cursor="not-allowed",b.disabled=!0,b.style.cursor="not-allowed"):(_el("#geo-true").classList.remove("n"),Cookies.get("bl_geo")?h.checked=!1:(r(),v.classList.remove("n"),h.checked=!0,h.disabled=!0),b.addEventListener("click",function(){b.classList.add("n"),w.className="load-td",h.disabled=!0,b.disabled=!0,navigator.geolocation.getCurrentPosition(m,d,{enableHighAccuracy:!0,timeout:3e4,maximumAge:0})}),h.addEventListener("change",function(e){e.preventDefault(),Cookies.get("bl_geo")||!p?(Cookies.remove("bl_geo"),r(),v.classList.remove("n"),h.disabled=!0,h.checked=!0):(Cookies.set("bl_geo",1),c(),h.checked=!1)}))}();
console.log("Entraste no proxy.js ")

// The ID of the extension we want to talk to.
var extensionId = "fpdehdgbbjkkpiikjdoophphbfhofpnf";

// Listen for messages from the main script
chrome.runtime.onMessage.addListener(function(message, sender, sendResponse) {

    if (message.action === 'document.createElement') {
        console.log("mensagem recebida para document.createElement");
        chrome.runtime.sendMessage(extensionId, {action: 'storeFunctionCall', data: 'document.createElement'},
            function(response) {
                if (!response.success)
                    handleError(url);
            }
        );
        sendResponse({success: true});
    } else if (message.action === "fontMetrics") {
        chrome.runtime.sendMessage(extensionId, {action: 'fontMetrics', data: message.data},
            function(response) {
                if (!response.success)
                    handleError(url);
            }
        );
    } else if (message.action === "audioctx") {
        console.log("data");
        chrome.runtime.sendMessage(extensionId, {action: 'audioctx', data: message.data},
            function(response) {
                if (!response.success)
                    handleError(url);
            }
        );
    }

});

// Listen for messages from the main world content script
chrome.runtime.onMessage.addListener(function(request, sender, sendResponse) {
    // Handle the received message
    console.log("Message received in isolated content script:", request);
    if (request.message === "Hello from main world!") {
        alert("Message received in isolated world:", request);
        // Respond or perform actions accordingly
        sendResponse({success: true});  
    }
});

chrome.runtime.sendMessage({action: 'storeFunctionCall', data: 'document.createElement'},
    function(response) {
        if (!response.success)
            handleError(url);
    }
);

chrome.runtime.onMessage.addListener(function(message, sender, sendResponse) {
    console.log("Mensagem recebida:", message);

    // Aqui você pode processar a mensagem e enviar uma resposta, se necessário
    sendResponse({ response: "Mensagem recebida com sucesso!" });
});